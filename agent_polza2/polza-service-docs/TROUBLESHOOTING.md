# Polza AI - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Polza AI.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è](#-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- [–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏](#-–æ—à–∏–±–∫–∏-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å API](#-–ø—Ä–æ–±–ª–µ–º—ã-—Å-api)
- [–û—à–∏–±–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤](#-–æ—à–∏–±–∫–∏-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- [–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#-–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- [Rate Limits](#-rate-limits)
- [–û—à–∏–±–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Tool Errors)](#-–æ—à–∏–±–∫–∏-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤-tool-errors)
- [–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ–π](#-–ø—Ä–æ–±–ª–µ–º—ã-—Å-–ø–æ—Ç–æ–∫–æ–≤–æ–π-–ø–µ—Ä–µ–¥–∞—á–µ–π)
- [–û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–æ—Ç–ª–∞–¥–∫–∞-–∏-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#-—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl -X GET "https://api.polza.ai/api/v1/models" \
  -H "Authorization: Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo" \
  -H "Content-Type: application/json" \
  -v

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (200 OK):
# HTTP/1.1 200 OK
# {"object":"list","data":[...]}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
nslookup api.polza.ai

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ping api.polza.ai

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
telnet api.polza.ai 443
```

### JavaScript –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```javascript
async function diagnoseConnection() {
  console.log('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Polza AI...');
  
  try {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
    const startTime = Date.now();
    const response = await fetch('https://api.polza.ai/api/v1/models', {
      headers: {
        'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo',
        'Content-Type': 'application/json'
      }
    });
    const responseTime = Date.now() - startTime;
    
    console.log(`‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ: ${response.status} (${responseTime}ms)`);
    
    if (response.ok) {
      const data = await response.json();
      console.log(`üìã –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: ${data.data.length}`);
      console.log('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:', data.data.map(m => m.id));
    } else {
      console.error(`‚ùå –û—à–∏–±–∫–∞ HTTP: ${response.status} ${response.statusText}`);
      const errorText = await response.text();
      console.error('üìã –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', errorText);
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error.message);
    
    // –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
      console.error('üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:');
      console.error('  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
      console.error('  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª/–ø—Ä–æ–∫—Å–∏');
      console.error('  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ api.polza.ai –¥–æ—Å—Ç—É–ø–µ–Ω');
    } else if (error.message.includes('CORS')) {
      console.error('üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:');
      console.error('  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–∫—Å–∏');
      console.error('  - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏');
    }
  }
}

// –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
diagnoseConnection();
```

### Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```python
import requests
import json
import time

def diagnose_connection():
    print("üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Polza AI...")
    
    url = "https://api.polza.ai/api/v1/models"
    headers = {
        "Authorization": "Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo",
        "Content-Type": "application/json"
    }
    
    try:
        start_time = time.time()
        response = requests.get(url, headers=headers, timeout=10)
        response_time = int((time.time() - start_time) * 1000)
        
        print(f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: HTTP {response.status_code} ({response_time}ms)")
        
        if response.status_code == 200:
            data = response.json()
            print(f"üìã –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(data.get('data', []))}")
            print("üìã –ú–æ–¥–µ–ª–∏:", [m.get('id') for m in data.get('data', [])])
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ HTTP: {response.status_code}")
            print("üìã –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", response.text)
            
    except requests.exceptions.ConnectionError as e:
        print("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", str(e))
        print("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å api.polza.ai")
        
    except requests.exceptions.Timeout as e:
        print("‚ùå –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", str(e))
        print("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞")
        
    except requests.exceptions.RequestException as e:
        print("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", str(e))

if __name__ == "__main__":
    diagnose_connection()
```

## üîê –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –û—à–∏–±–∫–∞ 401 - Invalid API Key

**–°–∏–º–ø—Ç–æ–º—ã:**
```
{
  "error": {
    "message": "Incorrect API key provided.",
    "type": "invalid_request_error",
    "code": "invalid_api_key"
  }
}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
- –ö–ª—é—á –∏—Å—Ç–µ–∫
- –ö–ª—é—á –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞

**–†–µ—à–µ–Ω–∏—è:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
echo $POLZA_API_KEY
# –∏–ª–∏
cat ~/.polza/config.json
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞:**
```javascript
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
headers: {
  'API-Key': 'ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo'
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
headers: {
  'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo'
}
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
export POLZA_API_KEY="ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ JavaScript
console.log('API Key:', process.env.POLZA_API_KEY ? '‚úÖ Set' : '‚ùå Missing');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Python
import os
print('API Key:', '‚úÖ Set' if os.getenv('POLZA_API_KEY') else '‚ùå Missing')
```

### –û—à–∏–±–∫–∞ 403 - Forbidden

**–°–∏–º–ø—Ç–æ–º—ã:**
```
{
  "error": {
    "message": "Your account does not have access to this resource.",
    "type": "permission_denied",
    "code": "insufficient_permissions"
  }
}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –º–æ–¥–µ–ª–∏
- –ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É

## üöÄ –ü—Ä–æ–±–ª–µ–º—ã —Å API

### –û—à–∏–±–∫–∞ 404 - Model Not Found

**–°–∏–º–ø—Ç–æ–º—ã:**
```
{
  "error": {
    "message": "The model `anthropic/claude-sonnet-4.5` does not exist",
    "type": "invalid_request_error",
    "param": "model",
    "code": "model_not_found"
  }
}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –º–æ–¥–µ–ª–∏
- –ú–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –û–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏

**–†–µ—à–µ–Ω–∏—è:**

1. **–ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π:**
```bash
curl -X GET "https://api.polza.ai/api/v1/models" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

```javascript
async function getAvailableModels() {
  try {
    const response = await fetch('https://api.polza.ai/api/v1/models', {
      headers: {
        'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo'
      }
    });
    
    const data = await response.json();
    console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:', data.data.map(m => m.id));
    
    return data.data.map(m => m.id);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π:', error);
    return [];
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const models = await getAvailableModels();
const validModel = models.includes('anthropic/claude-sonnet-4.5') 
  ? 'anthropic/claude-sonnet-4.5' 
  : models[0];
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π:**
```javascript
const VALID_MODELS = [
  'anthropic/claude-sonnet-4.5',
  'anthropic/claude-haiku-4.5',
  'anthropic/claude-opus-4.1'
];

function validateModel(modelId) {
  if (!VALID_MODELS.includes(modelId)) {
    throw new Error(`–ú–æ–¥–µ–ª—å ${modelId} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –î–æ—Å—Ç—É–ø–Ω—ã–µ: ${VALID_MODELS.join(', ')}`);
  }
  return modelId;
}
```

### –û—à–∏–±–∫–∞ 422 - Invalid Request

**–°–∏–º–ø—Ç–æ–º—ã:**
```
{
  "error": {
    "message": "Invalid request format",
    "type": "invalid_request_error",
    "param": "messages"
  }
}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON

**–†–µ—à–µ–Ω–∏—è:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
```javascript
function validateMessages(messages) {
  if (!Array.isArray(messages)) {
    throw new Error('messages –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º');
  }
  
  for (let i = 0; i < messages.length; i++) {
    const message = messages[i];
    
    if (!message.role || !['system', 'user', 'assistant'].includes(message.role)) {
      throw new Error(`–°–æ–æ–±—â–µ–Ω–∏–µ ${i}: –Ω–µ–≤–µ—Ä–Ω—ã–π role. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å system, user –∏–ª–∏ assistant`);
    }
    
    if (!message.content) {
      throw new Error(`–°–æ–æ–±—â–µ–Ω–∏–µ ${i}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç content`);
    }
    
    if (typeof message.content !== 'string') {
      throw new Error(`–°–æ–æ–±—â–µ–Ω–∏–µ ${i}: content –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π`);
    }
  }
  
  return true;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  validateMessages(messages);
  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –∑–∞–ø—Ä–æ—Å–æ–º
} catch (error) {
  console.error('–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞:', error.message);
}
```

2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞:**
```javascript
const requestBody = {
  model: 'anthropic/claude-sonnet-4.5',
  messages: [
    {
      role: 'system',
      content: 'You are a helpful assistant.'
    },
    {
      role: 'user',
      content: 'Hello!'
    }
  ],
  max_tokens: 1000,
  temperature: 0.7
};

// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
if (!requestBody.model || !requestBody.messages) {
  throw new Error('model –∏ messages –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã');
}

const response = await fetch('https://api.polza.ai/api/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(requestBody)
});
```

## ‚öôÔ∏è –û—à–∏–±–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### Tool Call Errors

**–°–∏–º–ø—Ç–æ–º—ã:**
```json
{
  "choices": [{
    "message": {
      "role": "assistant",
      "content": null,
      "tool_calls": [{
        "id": "call_123",
        "function": {
          "name": "nonexistent_tool",
          "arguments": "{}"
        }
      }]
    }
  }]
}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏—è:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
```javascript
class ToolManager {
  constructor() {
    this.tools = new Map();
  }
  
  registerTool(name, tool) {
    this.tools.set(name, tool);
  }
  
  getTool(name) {
    return this.tools.get(name);
  }
  
  listTools() {
    return Array.from(this.tools.keys());
  }
  
  async executeTool(name, args) {
    const tool = this.getTool(name);
    if (!tool) {
      throw new Error(`–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${name} –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ—Å—Ç—É–ø–Ω—ã–µ: ${this.listTools().join(', ')}`);
    }
    
    try {
      return await tool.execute(args);
    } catch (error) {
      return {
        success: false,
        error: error.message,
        tool: name,
        args
      };
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const toolManager = new ToolManager();

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
toolManager.registerTool('get_weather', {
  execute: async ({ location }) => {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
    return { temperature: 20, condition: 'sunny' };
  }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
async function handleToolCall(toolCall) {
  const { name, arguments: args } = toolCall.function;
  
  if (!toolManager.getTool(name)) {
    return {
      tool_call_id: toolCall.id,
      role: 'tool',
      content: JSON.stringify({
        error: `–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${name} –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω`,
        available_tools: toolManager.listTools()
      })
    };
  }
  
  try {
    const parsedArgs = JSON.parse(args);
    const result = await toolManager.executeTool(name, parsedArgs);
    
    return {
      tool_call_id: toolCall.id,
      role: 'tool',
      content: JSON.stringify(result)
    };
  } catch (error) {
    return {
      tool_call_id: toolCall.id,
      role: 'tool',
      content: JSON.stringify({
        error: error.message,
        tool: name
      })
    };
  }
}
```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
```javascript
function validateToolParameters(toolName, args, schema) {
  // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º—ã
  if (schema.required) {
    for (const requiredField of schema.required) {
      if (!(requiredField in args)) {
        throw new Error(`–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä ${requiredField} –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–ª—è ${toolName}`);
      }
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
  if (schema.properties) {
    for (const [field, fieldSchema] of Object.entries(schema.properties)) {
      if (field in args) {
        const value = args[field];
        const expectedType = fieldSchema.type;
        
        if (expectedType && typeof value !== expectedType) {
          throw new Error(`–ü–∞—Ä–∞–º–µ—Ç—Ä ${field} –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø–∞ ${expectedType}, –ø–æ–ª—É—á–µ–Ω ${typeof value}`);
        }
      }
    }
  }
  
  return true;
}

// –°—Ö–µ–º–∞ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø–æ–≥–æ–¥—ã
const weatherToolSchema = {
  type: "object",
  properties: {
    location: {
      type: "string",
      description: "–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞"
    },
    units: {
      type: "string",
      enum: ["celsius", "fahrenheit"],
      default: "celsius"
    }
  },
  required: ["location"]
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  validateToolParameters('get_weather', { location: 'Moscow' }, weatherToolSchema);
  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error.message);
}
```

## üìä –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```javascript
async function measurePerformance() {
  const startTime = Date.now();
  
  try {
    const response = await fetch('https://api.polza.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'anthropic/claude-sonnet-4.5',
        messages: [{ role: 'user', content: '–ü—Ä–∏–≤–µ—Ç!' }]
      })
    });
    
    const endTime = Date.now();
    const duration = endTime - startTime;
    
    console.log(`‚è±Ô∏è –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${duration}ms`);
    
    if (duration > 10000) {
      console.warn('‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (>10s)');
    }
    
    const data = await response.json();
    
    // –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    if (data.usage) {
      console.log('üìä –¢–æ–∫–µ–Ω—ã:', data.usage);
      
      const tokensPerSecond = data.usage.total_tokens / (duration / 1000);
      console.log(`üöÄ –°–∫–æ—Ä–æ—Å—Ç—å: ${tokensPerSecond.toFixed(2)} —Ç–æ–∫–µ–Ω–æ–≤/—Å–µ–∫`);
    }
    
    return data;
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);
    throw error;
  }
}
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:**
```javascript
// ‚ùå –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
const longPrompt = `
–í—ã - –æ—á–µ–Ω—å —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ.
–í–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏, –ø—Ä–∏–º–µ—Ä—ã –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ª–æ–≤.
–í–æ—Ç –º–æ–π –≤–æ–ø—Ä–æ—Å: ${userQuestion}
`;

// ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
const optimizedPrompt = `
–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å: ${userQuestion}
`;

console.log(`–†–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞: ${longPrompt.length} ‚Üí ${optimizedPrompt.length} —Å–∏–º–≤–æ–ª–æ–≤`);
```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –æ–∫–Ω–∞:**
```javascript
function optimizeContext(messages, maxTokens = 8000) {
  let totalTokens = 0;
  const optimized = [];
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏
  const sortedMessages = messages.sort((a, b) => {
    // System —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –≤–∞–∂–Ω—ã
    if (a.role === 'system') return -1;
    if (b.role === 'system') return 1;
    
    // –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∞–∂–Ω–µ–µ
    return messages.indexOf(b) - messages.indexOf(a);
  });
  
  for (const message of sortedMessages) {
    const messageTokens = estimateTokens(message.content);
    
    if (totalTokens + messageTokens <= maxTokens) {
      optimized.unshift(message); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
      totalTokens += messageTokens;
    } else {
      break; // –î–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞
    }
  }
  
  return optimized;
}

function estimateTokens(text) {
  // –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: 1 —Ç–æ–∫–µ–Ω ‚âà 4 —Å–∏–º–≤–æ–ª–∞
  return Math.ceil(text.length / 4);
}
```

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤:**
```javascript
class ResponseCache {
  constructor(ttl = 300000) { // 5 –º–∏–Ω—É—Ç
    this.cache = new Map();
    this.ttl = ttl;
  }
  
  get(key) {
    const cached = this.cache.get(key);
    if (cached && Date.now() - cached.timestamp < this.ttl) {
      return cached.data;
    }
    return null;
  }
  
  set(key, data) {
    this.cache.set(key, {
      data,
      timestamp: Date.now()
    });
  }
  
  generateKey(messages, options) {
    return JSON.stringify({ messages, options });
  }
  
  async getOrCompute(key, computeFn) {
    const cached = this.get(key);
    if (cached) {
      console.log('üìã –û—Ç–≤–µ—Ç –≤–∑—è—Ç –∏–∑ –∫—ç—à–∞');
      return cached;
    }
    
    console.log('üîÑ –í—ã—á–∏—Å–ª—è–µ–º –æ—Ç–≤–µ—Ç...');
    const data = await computeFn();
    this.set(key, data);
    return data;
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const cache = new ResponseCache();

async function cachedChat(messages, options = {}) {
  const key = cache.generateKey(messages, options);
  
  return await cache.getOrCompute(key, async () => {
    return await client.chat(messages, options);
  });
}
```

## üö¶ Rate Limits

### –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
```json
{
  "error": {
    "message": "Rate limit reached for requests",
    "type": "rate_limit_exceeded",
    "code": "rate_limit_exceeded"
  }
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤:**
```javascript
class RateLimitMonitor {
  constructor() {
    this.requestTimes = [];
    this.tokenUsage = [];
  }
  
  recordRequest() {
    this.requestTimes.push(Date.now());
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (—Å—Ç–∞—Ä—à–µ 1 –º–∏–Ω—É—Ç—ã)
    const oneMinuteAgo = Date.now() - 60000;
    this.requestTimes = this.requestTimes.filter(time => time > oneMinuteAgo);
  }
  
  recordTokenUsage(tokens) {
    this.tokenUsage.push({
      tokens,
      timestamp: Date.now()
    });
    
    // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
    const oneMinuteAgo = Date.now() - 60000;
    this.tokenUsage = this.tokenUsage.filter(entry => entry.timestamp > oneMinuteAgo);
  }
  
  getCurrentRate() {
    return this.requestTimes.length;
  }
  
  getCurrentTokenUsage() {
    return this.tokenUsage.reduce((sum, entry) => sum + entry.tokens, 0);
  }
  
  canMakeRequest(maxRequestsPerMinute = 60, maxTokensPerMinute = 100000) {
    const requests = this.getCurrentRate();
    const tokens = this.getCurrentTokenUsage();
    
    return {
      requests: {
        current: requests,
        limit: maxRequestsPerMinute,
        canProceed: requests < maxRequestsPerMinute
      },
      tokens: {
        current: tokens,
        limit: maxTokensPerMinute,
        canProceed: tokens < maxTokensPerMinute
      }
    };
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const monitor = new RateLimitMonitor();

async function makeRequestWithMonitoring(messages, options = {}) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã
  const limits = monitor.canMakeRequest();
  
  if (!limits.requests.canProceed) {
    const waitTime = 60000 - (Date.now() - monitor.requestTimes[0]);
    throw new Error(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${Math.ceil(waitTime / 1000)} —Å–µ–∫—É–Ω–¥`);
  }
  
  if (!limits.tokens.canProceed) {
    throw new Error(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –º–∏–Ω—É—Ç—É`);
  }
  
  // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
  monitor.recordRequest();
  
  try {
    const response = await client.chat(messages, options);
    
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
    if (response.usage) {
      monitor.recordTokenUsage(response.usage.total_tokens);
    }
    
    return response;
  } catch (error) {
    if (error.status === 429) {
      console.error('‚ö†Ô∏è Rate limit exceeded');
    }
    throw error;
  }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

```javascript
async function retryWithBackoff(fn, maxRetries = 3, baseDelay = 1000) {
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞
      if (attempt === maxRetries) {
        throw error;
      }
      
      // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ rate limit, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º
      if (error.status !== 429) {
        throw error;
      }
      
      // –í—ã—á–∏—Å–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è)
      const delay = baseDelay * Math.pow(2, attempt);
      
      console.log(`‚ö†Ô∏è Rate limit. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms (–ø–æ–ø—ã—Ç–∫–∞ ${attempt + 1}/${maxRetries})`);
      
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const response = await retryWithBackoff(() => 
  client.chat(messages, options)
);
```

## üêõ –û—à–∏–±–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Tool Errors)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö

```javascript
class ToolErrorHandler {
  static handleToolError(error, toolName, args) {
    console.error(`‚ùå –û—à–∏–±–∫–∞ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ ${toolName}:`, error.message);
    
    // –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫
    if (error.code === 'NETWORK_ERROR') {
      return {
        success: false,
        error: `–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ ${toolName}`,
        retryable: true,
        details: {
          tool: toolName,
          args,
          originalError: error.message
        }
      };
    }
    
    if (error.code === 'INVALID_INPUT') {
      return {
        success: false,
        error: `–ù–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${toolName}`,
        retryable: false,
        details: {
          tool: toolName,
          args,
          validationErrors: error.validationErrors
        }
      };
    }
    
    if (error.code === 'TIMEOUT') {
      return {
        success: false,
        error: `–¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ${toolName}`,
        retryable: true,
        details: {
          tool: toolName,
          args,
          timeout: error.timeout
        }
      };
    }
    
    // –û–±—â–∞—è –æ—à–∏–±–∫–∞
    return {
      success: false,
      error: `–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ ${toolName}: ${error.message}`,
      retryable: false,
      details: {
        tool: toolName,
        args,
        stack: error.stack
      }
    };
  }
  
  static async executeToolWithErrorHandling(tool, args) {
    try {
      return await tool.execute(args);
    } catch (error) {
      return ToolErrorHandler.handleToolError(error, tool.name, args);
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
async function executeToolSafely(toolName, args) {
  const tool = toolManager.getTool(toolName);
  if (!tool) {
    return {
      success: false,
      error: `–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${toolName} –Ω–µ –Ω–∞–π–¥–µ–Ω`,
      retryable: false
    };
  }
  
  return await ToolErrorHandler.executeToolWithErrorHandling(tool, args);
}
```

## üåä –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–µ–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –ø–æ—Ç–æ–∫–∞

```javascript
class StreamHandler {
  constructor() {
    this.abortController = null;
  }
  
  async streamChat(messages, options = {}) {
    this.abortController = new AbortController();
    
    try {
      const response = await fetch('https://api.polza.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ak_0xCOU-hEsCsImB6r-dg7GChm2LFPQOUL9ROwExY8WBo',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          ...options,
          model: 'anthropic/claude-sonnet-4.5',
          messages,
          stream: true
        }),
        signal: this.abortController.signal
      });
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      
      let buffer = '';
      let fullResponse = '';
      
      while (true) {
        const { done, value } = await reader.read();
        
        if (done) break;
        
        buffer += decoder.decode(value, { stream: true });
        const lines = buffer.split('\n');
        buffer = lines.pop(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–ø–æ–ª–Ω—É—é —Å—Ç—Ä–æ–∫—É
        
        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6);
            
            if (data === '[DONE]') {
              return { content: fullResponse, completed: true };
            }
            
            try {
              const parsed = JSON.parse(data);
              const content = parsed.choices[0]?.delta?.content;
              
              if (content) {
                fullResponse += content;
                console.log(content); // –ò–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
              }
            } catch (parseError) {
              console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', parseError.message);
            }
          }
        }
      }
      
      return { content: fullResponse, completed: true };
      
    } catch (error) {
      if (error.name === 'AbortError') {
        console.log('–ü–æ—Ç–æ–∫ –ø—Ä–µ—Ä–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
        return { content: fullResponse, completed: false, aborted: true };
      }
      
      console.error('–û—à–∏–±–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏:', error);
      return { content: fullResponse, completed: false, error: error.message };
    } finally {
      this.abortController = null;
    }
  }
  
  abort() {
    if (this.abortController) {
      this.abortController.abort();
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const streamHandler = new StreamHandler();

// –ù–∞—á–∞–ª–æ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
const result = await streamHandler.streamChat(messages);

// –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –∫–Ω–æ–ø–∫–µ "–û—Ç–º–µ–Ω–∞")
// streamHandler.abort();
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

```javascript
class RobustStreamHandler extends StreamHandler {
  async streamWithRetry(messages, options = {}, maxRetries = 3) {
    for (let attempt = 0; attempt <= maxRetries; attempt++) {
      try {
        return await this.streamChat(messages, options);
      } catch (error) {
        if (attempt === maxRetries) {
          throw error;
        }
        
        // –û—à–∏–±–∫–∏ —Å–µ—Ç–∏ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å
        if (this.isRetryableError(error)) {
          const delay = Math.pow(2, attempt) * 1000;
          console.log(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt + 1} –Ω–µ—É–¥–∞—á–Ω–∞. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms`);
          await new Promise(resolve => setTimeout(resolve, delay));
          continue;
        }
        
        // –ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ –æ—à–∏–±–∫–∏
        throw error;
      }
    }
  }
  
  isRetryableError(error) {
    // –ü–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ –æ—à–∏–±–∫–∏: —Å–µ—Ç—å, —Ç–∞–π–º–∞—É—Ç, 5xx
    return (
      error.name === 'TypeError' || // Network error
      error.message.includes('timeout') ||
      (error.status >= 500 && error.status < 600)
    );
  }
}
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
class PolzaLogger {
  constructor(enableDebug = false) {
    this.enableDebug = enableDebug;
    this.logs = [];
  }
  
  log(level, message, data = null) {
    const timestamp = new Date().toISOString();
    const logEntry = {
      timestamp,
      level,
      message,
      data
    };
    
    this.logs.push(logEntry);
    
    // –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
    const consoleMethod = {
      'error': 'error',
      'warn': 'warn',
      'info': 'info',
      'debug': 'debug'
    }[level] || 'log';
    
    console[consoleMethod](`[${timestamp}] ${message}`, data || '');
  }
  
  error(message, data) { this.log('error', message, data); }
  warn(message, data) { this.log('warn', message, data); }
  info(message, data) { this.log('info', message, data); }
  debug(message, data) { 
    if (this.enableDebug) {
      this.log('debug', message, data);
    }
  }
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
  logRequest(messages, options) {
    this.debug('API Request', {
      model: options.model || 'anthropic/claude-sonnet-4.5',
      messageCount: messages.length,
      totalChars: messages.reduce((sum, msg) => sum + msg.content.length, 0),
      options: {
        maxTokens: options.max_tokens,
        temperature: options.temperature,
        tools: options.tools ? options.tools.length : 0
      }
    });
  }
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
  logResponse(response, duration) {
    this.info('API Response', {
      duration: `${duration}ms`,
      tokens: response.usage ? {
        input: response.usage.prompt_tokens,
        output: response.usage.completion_tokens,
        total: response.usage.total_tokens
      } : null,
      finishReason: response.choices[0]?.finish_reason,
      hasToolCalls: !!response.choices[0]?.message?.tool_calls
    });
  }
  
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
  logError(error, context) {
    this.error('API Error', {
      message: error.message,
      status: error.status,
      type: error.type,
      context,
      stack: error.stack
    });
  }
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤
  getLogs(filter = {}) {
    return this.logs.filter(log => {
      if (filter.level && log.level !== filter.level) return false;
      if (filter.since && new Date(log.timestamp) < new Date(filter.since)) return false;
      return true;
    });
  }
  
  // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
  exportLogs() {
    return JSON.stringify(this.logs, null, 2);
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const logger = new PolzaLogger(process.env.DEBUG === 'true');

class LoggingPolzaClient {
  constructor(apiKey) {
    this.client = new PolzaClient(apiKey);
    this.logger = logger;
  }
  
  async chat(messages, options = {}) {
    const startTime = Date.now();
    
    try {
      this.logger.logRequest(messages, options);
      
      const response = await this.client.chat(messages, options);
      
      const duration = Date.now() - startTime;
      this.logger.logResponse(response, duration);
      
      return response;
    } catch (error) {
      const duration = Date.now() - startTime;
      this.logger.logError(error, { duration, messages, options });
      throw error;
    }
  }
}
```

### –û—Ç–ª–∞–¥–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

```javascript
class ToolDebugger {
  constructor(logger) {
    this.logger = logger;
  }
  
  async debugToolExecution(toolName, args, toolFunction) {
    this.logger.debug(`üîß –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: ${toolName}`, { args });
    
    const startTime = Date.now();
    
    try {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      this.logger.debug(`‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ${toolName}`);
      
      // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
      const result = await toolFunction(args);
      
      const duration = Date.now() - startTime;
      this.logger.debug(`‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ${toolName} –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`, {
        duration: `${duration}ms`,
        resultSize: JSON.stringify(result).length
      });
      
      return result;
    } catch (error) {
      const duration = Date.now() - startTime;
      this.logger.error(`‚ùå –û—à–∏–±–∫–∞ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ ${toolName}`, {
        duration: `${duration}ms`,
        error: error.message,
        args
      });
      throw error;
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const debugger = new ToolDebugger(logger);

async function executeToolWithDebug(toolName, args, toolFunction) {
  return await debugger.debugToolExecution(toolName, args, toolFunction);
}
```

## ‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ü–æ—á–µ–º—É API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 429?

**A:** –ü—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ —Ç–æ–∫–µ–Ω–æ–≤. –†–µ—à–µ–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ exponential backoff –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞–ø–≥—Ä–µ–π–¥ —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞

### Q: –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã?

**A:** 
```javascript
function splitLargeContext(messages, maxTokens = 180000) {
  let currentTokens = 0;
  const chunks = [];
  let currentChunk = [];
  
  for (const message of messages) {
    const messageTokens = estimateTokens(message.content);
    
    if (currentTokens + messageTokens > maxTokens && currentChunk.length > 0) {
      chunks.push(currentChunk);
      currentChunk = [message];
      currentTokens = messageTokens;
    } else {
      currentChunk.push(message);
      currentTokens += messageTokens;
    }
  }
  
  if (currentChunk.length > 0) {
    chunks.push(currentChunk);
  }
  
  return chunks;
}
```

### Q: –ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å?

**A:**
```javascript
class CostOptimizer {
  static calculateCost(usage, model = 'anthropic/claude-sonnet-4.5') {
    const pricing = {
      'anthropic/claude-sonnet-4.5': {
        input: 0.000003,  // $3 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
        output: 0.000015  // $15 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
      }
    };
    
    const rates = pricing[model] || pricing['anthropic/claude-sonnet-4.5'];
    
    return {
      inputCost: (usage.prompt_tokens / 1000000) * rates.input,
      outputCost: (usage.completion_tokens / 1000000) * rates.output,
      totalCost: ((usage.prompt_tokens / 1000000) * rates.input) + 
                 ((usage.completion_tokens / 1000000) * rates.output)
    };
  }
  
  static optimizePrompt(originalPrompt) {
    // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    const optimized = originalPrompt.replace(/\s+/g, ' ').trim();
    
    // –°—á–∏—Ç–∞–µ–º —ç–∫–æ–Ω–æ–º–∏—é
    const originalTokens = estimateTokens(originalPrompt);
    const optimizedTokens = estimateTokens(optimized);
    const savedTokens = originalTokens - optimizedTokens;
    
    return {
      original: originalPrompt,
      optimized,
      savedTokens,
      costSaving: (savedTokens / 1000000) * 0.000003 // $3 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
    };
  }
}
```

### Q: –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏?

**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ AbortController –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è fetch –∑–∞–ø—Ä–æ—Å–æ–≤.

### Q: –ü–æ—á–µ–º—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç?

**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–∞–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
4. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ—à–∏—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Polza AI.