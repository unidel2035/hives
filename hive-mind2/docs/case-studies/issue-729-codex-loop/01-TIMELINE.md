# Timeline: Codex Loop Incident (Issue #729)

## Overview

This document provides a detailed chronological timeline of the Codex loop incident, with timestamps, line numbers from the log, and key events.

## Phase 1: Initialization and First Failure (04:00:57 - 04:09:45)

### 04:00:57.949 - Execution Start
- **Log Line**: 1
- **Event**: solve.mjs v0.33.3 started
- **Command**: `solve https://github.com/deep-assistant/hive-mind/issues/719 --tool codex --auto-fork --auto-continue --attach-logs --verbose --no-tool-check`
- **Branch**: issue-719-a653aae7d4d5 (created)
- **PR**: #722 (created as draft)

### 04:01:49.329 - First Usage Limit Hit
- **Log Line**: ~254
- **Event**: First Codex execution immediately hits usage limit
- **Error Message**: `"You've hit your usage limit. To get more access now, send a request to your admin or try again at 9:01 AM."`
- **Session ID**: Multiple sessions created and failed
- **Impact**: Tool completes with usage limit error, no code changes made

### 04:09:45.574 - First Restart Trigger
- **Log Line**: 874
- **Event**: Feedback detected, system decides to restart
- **Feedback Sources**:
  - New comments on the pull request: 1
  - Pull request description was edited after last commit
- **Action**: System restarts Codex to "handle feedback"

## Phase 2: Slow Loop Pattern (04:09:45 - 05:30:00)

This phase shows the system in a relatively slow loop, restarting every 3-5 minutes.

### Restart Pattern Sample

| Time | Line | Restart # | Trigger | Comments | PR Edits |
|------|------|-----------|---------|----------|----------|
| 04:09:45 | 874 | 1 | Feedback | 1 | Yes |
| 04:14:52 | 1124 | 2 | Feedback | 1 | Yes |
| 04:18:04 | 1340 | 3 | Feedback | 1 | Yes |
| 04:21:39 | 1539 | 4 | Feedback | 0 | Yes |
| 04:24:51 | 1808 | 5 | Feedback | 0 | Yes |
| 04:27:58 | 1996 | 6 | Feedback | 0 | Yes |
| 04:31:45 | 2203 | 7 | Feedback | 0 | Yes |
| 04:35:13 | 2467 | 8 | Feedback | 1 | Yes |
| 04:39:49 | 4135 | 9 | Feedback | 2 | Yes |
| 04:42:47 | 4334 | 10 | Feedback | 2 | Yes |

**Key Observations**:
- Every restart shows "Pull request description was edited after last commit"
- Some restarts also show new comments (likely auto-generated by the tool itself)
- Average interval: ~3-5 minutes between restarts
- No actual code changes being made (all restarts hit usage limit immediately)

## Phase 3: Acceleration Period (05:30:00 - 05:35:00)

Around 05:30 UTC, the system behavior changes and restarts become much more frequent.

### 05:30:02 - Last "Normal" Execution
- **Log Line**: 8007
- **Event**: Codex executes normally with longer session
- **Activities**: Lint checks, documentation verification, code review
- **Session**: 019a7bb3-1ccc-77d3-8e1c-50f42c425d4e
- **Outcome**: Completes successfully, detects feedback, prepares to restart

### 05:34:42 - Final Successful Execution
- **Log Line**: 8023
- **Event**: Last execution that actually does work
- **Summary**: "All runs after the head commit are 'success'; no failures to download logs for."
- **Outcome**: Work appears complete, but feedback still detected

### 05:34:49 - Start of Rapid Loop
- **Log Line**: 8033
- **Event**: Restart #30 triggered
- **Feedback**: 2 new comments, PR description edited
- **Critical Change**: Loop speed increases dramatically from here

## Phase 4: Rapid Loop (05:35:00 - 08:34:55)

From this point forward, the system enters a rapid restart loop with ~7-8 second cycles.

### Sample of Rapid Restarts (All at 05:35 UTC)

| Time | Line | Session ID | Duration |
|------|------|------------|----------|
| 05:34:49 | 8033 | 019a7bb5-966a-7380-862f-131af5d005e7 | ~7s |
| 05:34:57 | 8405 | (next) | ~7s |
| 05:35:05 | 8461 | (next) | ~7s |
| 05:35:12 | 8517 | (next) | ~7s |
| 05:35:19 | 8573 | (next) | ~7s |
| 05:35:27 | 8629 | (next) | ~8s |
| 05:35:35 | 8685 | (next) | ~7s |
| 05:35:42 | 8741 | (next) | ~7s |
| 05:35:49 | 8797 | (next) | ~7s |
| 05:35:57 | 8854 | (next) | ~7s |

**Pattern Analysis**:
- Each restart follows identical pattern:
  1. Start Codex execution
  2. Hit usage limit immediately (~0.5 seconds)
  3. Complete "successfully" (exit code 0 despite error)
  4. Check for feedback
  5. Detect "2 new PR comments" and "PR description edited"
  6. Restart

**Why So Fast?**:
- Codex returns usage limit error almost instantly
- GitHub API calls are cached or very fast
- No actual work being done (no file operations, no commits)
- Pure overhead: restart → fail → detect feedback → restart

## Phase 5: Manual Intervention (08:34:55)

### 08:34:55.015 - CTRL+C Interruption
- **Log Line**: 81030 (near end)
- **Event**: Manual interruption via CTRL+C
- **Final State**:
  - Working directory preserved: `/tmp/gh-issue-solver-1763006468493`
  - Full log saved: `/home/hive/solve-2025-11-13T04-00-57-948Z.log`
  - Total runtime: 4 hours 33 minutes 58 seconds
  - Total restarts: 1,249
  - Total usage limit errors: 2,681

## Statistical Analysis

### Restart Frequency Over Time

| Phase | Time Range | Duration | Restarts | Avg Interval |
|-------|------------|----------|----------|--------------|
| 1 | 04:00-04:09 | 9 min | 0 | N/A |
| 2 | 04:09-05:30 | 81 min | ~27 | ~3 min |
| 3 | 05:30-05:35 | 5 min | ~40 | ~7.5 sec |
| 4 | 05:35-08:34 | 179 min | ~1182 | ~9 sec |

### Usage Limit Error Distribution

- **Total errors**: 2,681
- **Total restarts**: 1,249
- **Ratio**: 2.15 errors per restart
- **Explanation**: Multiple attempts or sessions per restart cycle

### Log Growth Rate

- **Total size**: ~140 MB
- **Total lines**: 81,031
- **Avg bytes/line**: ~1,815 bytes (includes JSON dumps)
- **Growth rate (rapid phase)**: ~466 KB/minute

## Root Cause Timeline

### What Should Have Happened

1. ✅ Codex hits usage limit → Detect limit reached
2. ✅ Check for auto-continue-limit flag
3. ❌ **MISSING**: If not set, exit with message about limit
4. ❌ **MISSING**: If consecutive limit hits > 3, stop restarting
5. ❌ **MISSING**: Validate that tool made progress before restarting

### What Actually Happened

1. ✅ Codex hits usage limit → Detect limit reached
2. ✅ Command completes (no error thrown)
3. ❌ Check for uncommitted changes (none, because tool did nothing)
4. ❌ Check for feedback (ALWAYS true due to PR description timestamp)
5. ❌ Restart without any validation
6. ❌ Repeat infinitely

## Key Metrics

- **First usage limit**: 00:00:52 (52 seconds after start)
- **First restart**: 00:08:48 (8 minutes 48 seconds after start)
- **Loop acceleration**: 01:33:52 (1 hour 33 minutes after start)
- **Fastest restart cycle**: ~7 seconds
- **Slowest restart cycle**: ~5 minutes
- **Average restart cycle (rapid phase)**: ~9 seconds
- **Log file writes**: Continuous throughout execution
- **GitHub API calls**: ~10-15 per restart (for feedback detection)
- **Estimated API calls**: 12,490 - 18,735 total

## Lessons Learned

1. **Usage limits need circuit breakers**: Consecutive failures should stop execution
2. **Feedback detection needs validation**: Don't restart unless actual work was done
3. **Self-triggering is dangerous**: Tool-generated comments/edits shouldn't trigger restarts
4. **Exponential backoff is critical**: Rapid restarts waste resources and hit APIs
5. **Monitoring is essential**: 4.5 hours of looping should have been caught sooner

## Next Steps

See `00-OVERVIEW.md` for proposed solutions and prevention checklist.
