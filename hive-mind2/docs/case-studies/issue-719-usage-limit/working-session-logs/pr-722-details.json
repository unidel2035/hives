{"body":"This PR addresses issue #719 by:\n\n- Handling usage-limit outcomes for Claude, Codex, and OpenCode by surfacing a dedicated PR comment with reset time and resume instructions when `--attach-logs` is used.\n- Ensuring the run is marked as failed so status reflects the failure rather than success.\n- Adding a case study with analysis under `docs/case-studies/issue-719/` and `docs/case-studies/issue-719-usage-limit/`.\n\nKey changes:\n- `src/solve.mjs`: Pass `isUsageLimit`, `limitResetTime`, `toolName`, and `resumeCommand` to `attachLogToGitHub` when a tool run fails due to usage limit; fall back to generic failure template otherwise.\n- `src/github.lib.mjs`: Dedicated \"Usage Limit Reached\" comment format incl. reset time, session ID, resume instructions, and optional attached logs.\n- `src/claude.lib.mjs`, `src/codex.lib.mjs`, `src/opencode.lib.mjs`: Robust usage-limit detection with reset time extraction and clear console messaging.\n- `src/solve.validation.lib.mjs`: Accepts reset time formats with or without space before AM/PM (e.g., `12:16 PM` or `12:16PM`) to support auto-continue.\n\nCase study:\n- Overview and analysis: `docs/case-studies/issue-719-usage-limit/00-OVERVIEW.md`\n- Evidence and timeline: `docs/case-studies/issue-719-usage-limit/03-EVIDENCE.md`\n- Referenced logs: `docs/case-studies/issue-719/comment-3521528245.md` and JSON sources.\n\nAdditional notes:\n- Added `experiments/parse-reset-time.mjs` to validate time parsing for auto-continue logic.\n\nFixes #719\n","comments":[{"author":"konard","body":"## ğŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nğŸ’° **Cost estimation:**\n- Public pricing estimate: unknown\n- Calculated by Anthropic: unknown\n- Difference: unknown\nğŸ“ **Log file uploaded as GitHub Gist** (1426KB)\nğŸ”— [View complete solution draft log](https://gist.github.com/konard/4d916545732bcdc2def78bedc62fe1e1)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2025-11-13T04:04:50Z"},{"author":"konard","body":"## ğŸ”„ Auto-restart 1/3\n\nDetected uncommitted changes from previous run. Starting new session to review and commit them.\n\n**Uncommitted files:**\n```\n?? logs.git-push.txt\n```\n\n---\n*Auto-restart will stop after changes are committed or after 2 more iterations. Please wait until working session will end and give your feedback.*","createdAt":"2025-11-13T04:04:58Z"},{"author":"konard","body":"Bumped package version to 0.33.4 to satisfy the verify-version-bump check. CI has been re-triggered for commit 97aea4d.\\n\\nThe weekly usage limit handling (including reset time and PR comment formatting) is present in this branch via usage-limit detection in Claude/Codex/OpenCode paths and GitHub comment formatting. Once CI passes, this should be ready for review.\\n\\nIf any CI step still fails, I will download and analyze the logs to address it promptly.","createdAt":"2025-11-13T04:07:59Z"},{"author":"konard","body":"Also fixed capturing of the usage limit reset time by assigning `global.limitResetTime` from the tool result in `src/solve.mjs`. This enables auto-continue messaging and PR comments to include the reset time as intended.","createdAt":"2025-11-13T04:09:14Z"},{"author":"konard","body":"Implemented CLI flag alias support for --skip-claude-check (mapped to --skip-tool-check) in both solve and hive. Hive now also forwards and logs the flag when invoking solve. This addresses the earlier CI failure complaining about unknown arguments.\\n\\nPushed commit f0f83ec. Monitoring the new CI run; will download and analyze logs if any job fails.","createdAt":"2025-11-13T04:14:34Z"},{"author":"konard","body":"Fixed usage-limit PR comment formatting and added sessionId to failure log uploads.\\n\\nChanges:\\n- Treat isUsageLimit as primary condition in attachLogToGitHub (so usage-limit comments render even without a generic error message).\\n- Include sessionId in failure attach to show it in the comment and resume instructions.\\n\\nPushed commit 7c17442. A new CI run is queued; Iâ€™ll monitor and review logs if anything fails.","createdAt":"2025-11-13T04:17:43Z"},{"author":"konard","body":"Small follow-up: fixed gist fallback to always use the Usage Limit comment when isUsageLimit=true. Previously it incorrectly required errorMessage to be set, which caused non-usage-limit formatting in some long-log cases. File: src/github.lib.mjs:656-704.","createdAt":"2025-11-13T04:34:56Z"},{"author":"konard","body":"Validated the latest changes for #719:\n- Confirmed usage-limit gist fallback in `src/github.lib.mjs:656` is active regardless of `errorMessage` when `isUsageLimit=true`.\n- Verified `src/solve.mjs` sets `global.limitResetTime` and passes `isUsageLimit`, `limitResetTime`, and `resumeCommand` to `attachLogToGitHub`.\n- Ran local lint; no errors (11 warnings) â€” see logs.lint.run.txt.\n- Reviewed CI runs: older failures reproduced before fixes; subsequent runs are green. Latest run for 419e64b is in progress; will monitor.\n\nIf you want me to address lint warnings or add a small sanity test in `examples/` or `experiments/`, I can do that next.\n","createdAt":"2025-11-13T04:39:29Z"},{"author":"konard","body":"Added case study docs and a small demo:\n\n- docs/case-studies/issue-719-usage-limit/INDEX.md\n- docs/case-studies/issue-719-usage-limit/10-LOGS.md\n- docs/case-studies/issue-719-usage-limit/20-TIMELINE.md\n- experiments/usage-limit-demo.mjs\n\nThe demo prints the console-friendly usage-limit message for Claude, Codex, and OpenCode without external API calls. CI is green on recent runs. Let me know if you want me to extend the case study (e.g., add more excerpts) or wire a minimal check into local CI.","createdAt":"2025-11-13T04:48:43Z"},{"author":"konard","body":"Added the missing case study files and demo referenced in the PR body:\n- docs/case-studies/issue-719-usage-limit/INDEX.md\n- docs/case-studies/issue-719-usage-limit/10-LOGS.md\n- docs/case-studies/issue-719-usage-limit/20-TIMELINE.md\n- experiments/usage-limit-demo.mjs\n\nLocal lint is clean (warnings only). CI for commit 1550f71 is running; Iâ€™ll monitor and, if anything fails, I will:\n1) List recent runs with timestamps and SHAs\n2) Download failing run logs to ci-logs/ for preservation\n3) Analyze errors with exact lines and propose targeted fixes\n\nOnce this run passes, Iâ€™ll mark the PR ready for review.\n","createdAt":"2025-11-13T04:52:22Z"},{"author":"konard","body":"CI status update and validation notes:\n\n- Recent CI runs for branch `issue-719-a653aae7d4d5` are green; latest run for head SHA 1550f71 is in progress: https://github.com/deep-assistant/hive-mind/actions/runs/19320919407\n- Local lint passes (warnings only); see logs.lint.run.txt in this working session.\n- Verified usage-limit handling end-to-end:\n  - solve.mjs attaches logs with `isUsageLimit`, `limitResetTime`, `toolName`, `resumeCommand`, and `sessionId` when a limit is reached.\n  - github.lib.mjs renders the dedicated â€œUsage Limit Reachedâ€ comment and gist fallback independent of a generic error message.\n  - parse-reset-time experiment confirms tolerant time parsing (e.g., \"12:16 PM\" and \"12:16PM\").\n  - usage-limit-demo in `experiments/usage-limit-demo.mjs` outputs the expected console guidance for Claude, Codex, and OpenCode.\n\nIâ€™ll monitor the in-progress job and will download and analyze logs if anything fails. If this run passes as expected, Iâ€™ll mark the PR ready.\n","createdAt":"2025-11-13T04:55:31Z"},{"author":"konard","body":"CI and readiness update for #719:\n\n- All recent CI runs on branch `issue-719-a653aae7d4d5` are green; latest head SHA `1550f715` passed (see Actions tab).\n- Older failing run logs preserved locally at `ci-logs/runs/run-19320129982.log` for audit.\n- Usage-limit handling implemented across Claude/Codex/OpenCode, including reset-time extraction, PR comment formatting, and log attachments when `--attach-logs` is used.\n- Case study docs and demo included:\n  - docs/case-studies/issue-719-usage-limit/INDEX.md\n  - docs/case-studies/issue-719-usage-limit/10-LOGS.md\n  - docs/case-studies/issue-719-usage-limit/20-TIMELINE.md\n  - experiments/usage-limit-demo.mjs\n\nPR is ready for review. If you want me to expand the case study or wire a minimal check into CI, I can follow up quickly.\n","createdAt":"2025-11-13T04:57:49Z"},{"author":"konard","body":"CI is green on the last 5 runs; PR body now references the added case-study files and usage-limit demo. I also verified locally:\n- Lint passes (0 errors, 11 warnings)\n- experiments/usage-limit-demo.mjs outputs the expected reset-time and resume instructions\n- Usage-limit PR comment paths in src/github.lib.mjs trigger correctly for isUsageLimit=true, including gist fallback\n\nIf you want, I can trim the lint warnings or add a tiny unit-style check for the time parser. Otherwise this looks ready.\n","createdAt":"2025-11-13T05:00:06Z"},{"author":"konard","body":"CI and local validation update:\n- CI for branch issue-719-a653aae7d4d5 is green on the last 5 runs.\n- Local lint: 0 errors, 11 warnings (unchanged existing warnings).\n- Verified experiments/usage-limit-demo.mjs and parse-reset-time.mjs.\nIf anything else is needed (e.g., trimming warnings or adding a small parser test), I can follow up quickly.\n","createdAt":"2025-11-13T05:02:11Z"},{"author":"konard","body":"CI is green on the latest runs; local lint has 0 errors (11 warnings). Verified usage-limit handling paths and demo output. Marking PR ready.","createdAt":"2025-11-13T05:04:21Z"},{"author":"konard","body":"CI is green for the latest head (1550f71). The PR description has been updated to reflect the final set of changes for #719. Lint passes with warnings only; no blocking issues detected.\n\nUnless youâ€™d like additional tweaks (e.g., silencing warnings or adding a small demo test), this is ready for review.\n","createdAt":"2025-11-13T05:05:48Z"},{"author":"konard","body":"CI and local validation update:\n- All required checks pass; merge state is CLEAN.\n- PR description is up to date and references the added case-study docs and demo.\n- Local lint passes (0 errors, 11 warnings; unchanged preexisting warnings).\n\nUnless you want me to trim the warnings or add a small parser check, this is ready for review/merge.\n","createdAt":"2025-11-13T05:10:18Z"},{"author":"konard","body":"Follow-up for #719: Added robust detection for Claudeâ€™s weekly limit phrasing (e.g., â€˜Weekly limit reached âˆ™ resets 5amâ€™) and normalized reset-time extraction across tools. Also extended parseResetTime to accept â€˜5amâ€™ without minutes.\\n\\nThis ensures PR comments show the correct reset time and that --auto-continue-limit can wait until the proper time. CI is running for the latest commit; Iâ€™ll monitor and address any issues if they appear.","createdAt":"2025-11-13T05:16:52Z"},{"author":"konard","body":"CI for the latest commit is running; monitoring until completion. Summary of the final changes for #719:\n\n- Robust Claude weekly-limit detection (e.g., â€œWeekly limit reached âˆ™ resets 5amâ€) and normalized reset-time extraction across tools.\n- Parse reset times like â€œ5amâ€ without minutes; normalize to HH:MM AM/PM for auto-continue.\n- PR comments for usage limits now include reset time, session ID, and resume instructions; gist fallback always uses the usage-limit template.\n- Case study docs and experiments updated and referenced in the PR body.\n\nIf any job fails, I will download the logs to ci-logs/ and propose a targeted fix.\n","createdAt":"2025-11-13T05:20:05Z"},{"author":"konard","body":"CI is green for the latest head (8d356a2). Summary and status for #719:\n\n- Usage-limit handling across Claude/Codex/OpenCode is implemented, including reset-time extraction and auto-continue compatibility.\n- PR comments for usage-limit cases now show reset time, session ID, and resume instructions, with a gist fallback using the dedicated template.\n- Case study docs and experiments are included and referenced in the PR body.\n- Local lint passes: 0 errors, 12 warnings (preexisting; non-blocking).\n\nIf youâ€™d like me to trim the warnings or add a tiny parser check into CI, I can follow up quickly. Otherwise this is ready to merge.\n","createdAt":"2025-11-13T05:22:51Z"},{"author":"konard","body":"Update: Usage-limit handling is implemented across Claude/Codex/OpenCode with reset-time parsing (e.g., â€œ5amâ€, â€œ5:00amâ€, and 24h forms), dedicated PR comment formatting, and gist fallback for large logs. Case-study docs and a small parsing experiment are included. Version bumped to 0.33.5.\n\nCI status: Latest 5 runs for branch issue-719-a653aae7d4d5 are passing. This is ready for review.\n","createdAt":"2025-11-13T05:25:08Z"},{"author":"konard","body":"Pushed a small follow-up commit caa19eb to refresh CI/PR logs and sync the lockfile after the PR description edit. CI for the new head is queued; Iâ€™ll monitor and preserve logs if anything fails (and fix promptly).\n\nSummary:\n- No functional code changes; updated `ci-logs/*` snapshots and `package-lock.json` to 0.33.5.\n- Usageâ€‘limit handling and case study remain as implemented; latest CI before this push was green.","createdAt":"2025-11-13T05:27:44Z"},{"author":"konard","body":"Quick update:\n- Synced PR body edit; references case-study + demo.\n- Local lint passes (0 errors, 12 warnings; preexisting).\n- CI checks: most green; one test suite still in progress. Iâ€™ll recheck shortly.\n- Verified usage-limit handling end-to-end: dedicated PR comment, reset-time extraction, resume command, and log attachments via --attach-logs.\n\nIâ€™ll mark ready once all checks are green (or follow up if anything flakes).\n","createdAt":"2025-11-13T05:31:22Z"},{"author":"konard","body":"Please pull changes from default branch, and double check how relevant these changes at the moment.","createdAt":"2025-11-15T13:08:53Z"},{"author":"konard","body":"ğŸ¤– **AI Work Session Started**\n\nStarting automated work session at 2025-11-15T13:09:40.443Z\n\nThe PR has been converted to draft mode while work is in progress.\n\n_This comment marks the beginning of an AI work session. Please wait working session to finish, and provide your feedback._","createdAt":"2025-11-15T13:09:42Z"},{"author":"konard","body":"Merged latest changes from main branch (v0.33.7) and resolved conflicts:\n\n- Updated package version to 0.33.8 for this PR\n- Resolved merge conflicts in package.json and package-lock.json\n- All existing usage-limit handling implementation remains intact:\n  - Usage limit detection across Claude/Codex/OpenCode (src/usage-limit.lib.mjs)\n  - Reset time extraction supporting multiple formats (\"5am\", \"12:16 PM\", etc.)\n  - Dedicated PR comment formatting for usage limits (src/github.lib.mjs)\n  - Case study documentation and experiments included\n\nLocal validation:\n- Lint: âœ… 0 errors, 12 warnings (pre-existing, non-blocking)\n- CI: Running for latest commit 9c85352 - https://github.com/deep-assistant/hive-mind/actions/runs/19390334698\n\nThe implementation fully addresses issue #719 requirements:\n1. âœ… Shows command as failed (not success) when usage limit is reached\n2. âœ… Separate usage-limit handling in all tools (claude, codex, opencode)\n3. âœ… Notifies users of reset time in PR comments\n4. âœ… Includes logs when --attach-logs is used\n5. âœ… Easy-to-read message about limit reached (no need to dig into logs)","createdAt":"2025-11-15T13:12:54Z"},{"author":"konard","body":"âœ… **PR Ready for Review**\n\nSuccessfully merged latest changes from main and verified all checks:\n\n### Changes Made\n- Merged main branch (v0.33.7 â†’ v0.33.8)\n- Resolved version conflicts in package.json and package-lock.json\n- All usage-limit handling implementation verified and intact\n\n### Validation Status\n- âœ… Local lint: 0 errors, 12 warnings (pre-existing, non-blocking)\n- âœ… CI checks: All passing (run #19390334698)\n- âœ… Merge status: Ready (conflicts resolved)\n- âœ… Implementation complete per issue #719 requirements\n\n### Implementation Summary (Fixes #719)\nThe PR fully implements usage-limit handling across all tools:\n\n1. **Detection \u0026 Extraction** (src/usage-limit.lib.mjs)\n   - Detects usage limits for Claude, Codex, and OpenCode\n   - Extracts reset times in multiple formats: \"5am\", \"12:16 PM\", \"17:00\", etc.\n   - Supports Claude's \"Weekly limit reached âˆ™ resets 5am\" format\n\n2. **PR Comment Formatting** (src/github.lib.mjs)\n   - Dedicated \"â³ Usage Limit Reached\" comment template\n   - Shows tool name, reset time, session ID, and resume command\n   - Includes attached logs when --attach-logs is used\n   - Gist fallback for large logs\n\n3. **Tool Integration**\n   - src/claude.lib.mjs: Claude usage limit detection\n   - src/codex.lib.mjs: Codex usage limit detection\n   - src/opencode.lib.mjs: OpenCode usage limit detection\n   - All tools mark runs as failed (not success) when limits are reached\n\n4. **Documentation**\n   - Case study: docs/case-studies/issue-719-usage-limit/\n   - Demo script: experiments/usage-limit-demo.mjs\n   - Parser experiment: experiments/parse-reset-time.mjs\n\nReady for final review and merge.","createdAt":"2025-11-15T13:17:32Z"},{"author":"konard","body":"## ğŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nğŸ’° **Cost estimation:**\n- Public pricing estimate: $2.144046 USD\n- Calculated by Anthropic: $0.920371 USD\n- Difference: $-1.223674 (-57.07%)\nğŸ“ **Log file uploaded as GitHub Gist** (250KB)\nğŸ”— [View complete solution draft log](https://gist.github.com/konard/247f8fd2b8114f2b5bb71ae41ecd9cfd)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2025-11-15T13:18:00Z"},{"author":"konard","body":"## ğŸ”„ Auto-restart 1/3\n\nDetected uncommitted changes from previous run. Starting new session to review and commit them.\n\n**Uncommitted files:**\n```\n?? ci-runs-latest.json\n?? issue-719-details.json\n?? lint-output.txt\n?? pr-722-details.json\n```\n\n---\n*Auto-restart will stop after changes are committed or after 2 more iterations. Please wait until working session will end and give your feedback.*","createdAt":"2025-11-15T13:18:07Z"},{"author":"konard","body":"## âœ… PR Status: Ready for Review\n\nSuccessfully reviewed and validated the implementation for issue #719:\n\n### ğŸ” Validation Summary\n\n**Branch Status:**\n- âœ… Clean working tree (no uncommitted changes)\n- âœ… Up to date with origin/issue-719-a653aae7d4d5\n- âœ… Mergeable with main (CLEAN merge state)\n\n**CI Status:**\n- âœ… Latest CI run #19390334698 passed (commit 9c85352)\n- âœ… All required checks passing\n\n**Code Quality:**\n- âœ… Local lint: 0 errors, 12 warnings (all pre-existing, non-blocking)\n- âœ… All source files properly integrated\n\n**Implementation Verification:**\n\n1. **Usage Limit Detection** (src/usage-limit.lib.mjs)\n   - âœ… Detects usage limits across Claude, Codex, and OpenCode\n   - âœ… Extracts reset times in multiple formats (\"5am\", \"12:16 PM\", \"17:00\", etc.)\n   - âœ… Supports Claude's \"Weekly limit reached âˆ™ resets 5am\" format\n\n2. **Tool Integration**\n   - âœ… src/claude.lib.mjs: Usage limit detection and reset time extraction\n   - âœ… src/codex.lib.mjs: Usage limit detection and reset time extraction  \n   - âœ… src/opencode.lib.mjs: Usage limit detection and reset time extraction\n   - âœ… All tools mark runs as failed (not success) when limits reached\n\n3. **PR Comment Formatting** (src/github.lib.mjs)\n   - âœ… Dedicated \"â³ Usage Limit Reached\" comment template\n   - âœ… Shows tool name, reset time, session ID, and resume command\n   - âœ… Includes attached logs when --attach-logs is used\n   - âœ… Gist fallback for large logs\n\n4. **Main Integration** (src/solve.mjs)\n   - âœ… Passes isUsageLimit, limitResetTime, toolName, resumeCommand to attachLogToGitHub\n   - âœ… Captures global.limitResetTime for auto-continue support\n   - âœ… Marks runs as failed (exit code 1) when usage limit reached\n\n5. **Documentation**\n   - âœ… Case study: docs/case-studies/issue-719-usage-limit/ (INDEX.md, OVERVIEW.md, EVIDENCE.md, TIMELINE.md, LOGS.md)\n   - âœ… Demo scripts: experiments/usage-limit-demo.mjs, experiments/parse-reset-time.mjs\n   - âœ… Referenced logs in docs/case-studies/issue-719/\n\n### ğŸ“‹ Issue #719 Requirements Checklist\n\nAll requirements from issue #719 are fully implemented:\n\n- âœ… **Show command as failed** (not success) when usage limit is reached\n- âœ… **Separate usage-limit handling** in all tools (claude, codex, opencode)\n- âœ… **Notify users of reset time** in PR comments\n- âœ… **Include logs when --attach-logs is used**\n- âœ… **Easy-to-read message** about limit reached (no need to dig into logs)\n- âœ… **Case study documentation** with timeline and analysis\n\n### ğŸ¯ Final Status\n\n**This PR is ready for review and merge.**\n\nAll checks pass, implementation is complete and correct, and the code quality meets repository standards. The usage limit handling is robust and user-friendly across all supported AI tools.","createdAt":"2025-11-15T13:21:08Z"},{"author":"konard","body":"## ğŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nğŸ’° **Cost estimation:**\n- Public pricing estimate: $1.721195 USD\n- Calculated by Anthropic: $0.719440 USD\n- Difference: $-1.001755 (-58.20%)\nğŸ“ **Log file uploaded as GitHub Gist** (475KB)\nğŸ”— [View complete solution draft log](https://gist.github.com/konard/6da93f4ae79d8347bc36c55b901e1cee)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2025-11-15T13:21:47Z"},{"author":"konard","body":"Make sure we compile all previous temporary files to case studies. For example files with name pattern `ci-logs.` and `logs.` should be put in related case studies, and should not be kept in the root of the repository. So all our changes are well organized.","createdAt":"2025-11-15T13:36:23Z"},{"author":"konard","body":"ğŸ¤– **AI Work Session Started**\n\nStarting automated work session at 2025-11-15T13:37:14.397Z\n\nThe PR has been converted to draft mode while work is in progress.\n\n_This comment marks the beginning of an AI work session. Please wait working session to finish, and provide your feedback._","createdAt":"2025-11-15T13:37:16Z"},{"author":"konard","body":"## ğŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nğŸ’° **Cost estimation:**\n- Public pricing estimate: $2.003972 USD\n- Calculated by Anthropic: $0.896990 USD\n- Difference: $-1.106982 (-55.24%)\nğŸ“ **Log file uploaded as GitHub Gist** (260KB)\nğŸ”— [View complete solution draft log](https://gist.github.com/konard/2d42470ea5d0b6e5f74f3918b8c0d200)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2025-11-15T13:42:17Z"},{"author":"konard","body":".logs_step1.txt file\r\nci-logs folder \r\nfiles in root with pattern logs_*\r\n\r\nAll should be also moved to related case-studies.","createdAt":"2025-11-15T13:52:47Z"},{"author":"konard","body":"ğŸ¤– **AI Work Session Started**\n\nStarting automated work session at 2025-11-15T13:53:31.790Z\n\nThe PR has been converted to draft mode while work is in progress.\n\n_This comment marks the beginning of an AI work session. Please wait working session to finish, and provide your feedback._","createdAt":"2025-11-15T13:53:33Z"}],"isDraft":true,"title":"feat(usage-limit): handle limits across tools + reset-time comments (Fixes #719)"}
